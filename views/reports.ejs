<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Generate Meeting Report</title>
   <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
   <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
   <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
   <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">
   <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>
   <link href="/css/style.css" rel="stylesheet" type="text/css">
   <link href="/css/addRequest.css" rel="stylesheet" type="text/css">
</head>
<body>
    <div class="my-3">
        <div class="card mx-auto" style="max-width: 400px;border-radius: 18px;">
            <form action="/reports" method="post">
                <div class="card-body row">
                    <div class="col-12">
                        <div class="form-field">
                            <select name="meeting_id" class="form-control">
                                <option selected>Select Meeting</option>
                                <% params.meetings.forEach(meeting => { %>
                                    <option value="<%= meeting.id %>"><%= meeting.name %></option>
                                <% }) %>
                            </select>
                        </div>
                    </div>
                    <div class="col-12 text-center mt-3">
                        <button type="submit" class="btn btn-success" id="btn_submit">Submit</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <% if(params.requests.length > 0){ %>
        <% params.requests.forEach(request => { %>
            <section class="get-in-touch">
                <h2 class="text-center py-2" style="border-bottom: 1px solid darkgray;"><%= request.title %></h2>
                <div class="px-3">
                    <div class="row">
                        <b class="col-3">Description</b>
                        <p class="col-9" style="word-break: break-all;"><%= request.description %></p>
                        <b class="col-3">Created At</b>
                        <p class="col-9" style="word-break: break-all;"><%= request.created_at  %></p>
                        <b class="col-3">Created By</b>
                        <p class="col-9" style="word-break: break-all;"><%= request.created_by %></p>
                        <% if (request.category_names.length > 0) { %> 
                            <b class="col-3">Department Name</b>
                            <p class="col-9" style="word-break: break-all;"><%= request.category_names.join(", ") %></p>
                            <b class="col-3">Department Set By</b>
                            <p class="col-9" style="word-break: break-all;"><%= request.category_set_by %></p>
                        <% } %>
                            <b class="col-3 my-4">Status</b>
                            <p class="col-9 my-4" style="word-break: break-all;">
                        <%- request.open === 0 ? "Closed" : request.category_names.length > 0 && request.approved ? "Sent to Departmental Review" : request.category_names.length > 0 && !request.approved ? "Sent for Department Approval" : request.level_3_remarks.length > 0 || request.level_4_remarks.length > 0 ? "Remarked" : "Open" %>
                        </p>
                        <% if (params.open === 0) { %> 
                            <b class="col-3">Closed At</b>
                            <p class="col-9" style="word-break: break-all;"><%= request.closed_at %></p>
                            <b class="col-3">Closed By</b>
                            <p class="col-9" style="word-break: break-all;"><%= request.closed_by %></p>
                        <% } %>
                        <!-- level 2 -->
                        <% if(request.level_2_remarks.length > 0) { %> 
                            <b class="col-3">DPO Remarks</b>
                            <div class="col-9" style="word-break: break-all;">
                                <% request.level_2_remarks.forEach(remark => { %>
                                    <p style="word-break: break-all;"><%= remark.remark %></p>
                                <% }); %>
                            </div>
                        <% } %>
                        <!-- level 3 -->
                        <% if(request.level_3_remarks.length > 0) { %> 
                            <b class="col-3">BO Remarks</b>                  
                            <div class="col-9" style="word-break: break-all;">
                                <% request.level_3_remarks.forEach(remark => { %>
                                    <p style="word-break: break-all;"><%= remark.remark %></p>
                                <% }); %>
                            </div>
                        <% } %>
                        <!-- level 4 -->
                        <% if(request.level_4_remarks.length > 0) { %> 
                            <b class="col-3">OS Remarks</b>
                            <div class="col-9" style="word-break: break-all;">
                                <% request.level_4_remarks.forEach(remark => { %>
                                    <p style="word-break: break-all;"><%= remark.remark %></p>
                                <% }); %>
                            </div>
                        <% } %>
                    </div>
                </div>
                <% if (params.dateError) { %>
                    <div class="col-12">
                        <div class="alert alert-danger mt-2 w-100" role="alert">
                            <strong>Opps! Some error occured! Please try again with valid entries or try in some time.</strong>
                            </div>
                    </div>
                <% } %>  
            </section>    
        <% })%>
    <% } %>
</body>
</html>